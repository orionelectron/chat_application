<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes typing {
            0% {
                opacity: 1;
                transform: translateX(0) translateY(0);
            }

            33% {
                opacity: 1;
                transform: translateX(10px) translateY(5px);
            }

            66% {
                opacity: 1;
                transform: translateX(-10px) translateY(-5px);
            }

            100% {
                opacity: 1;
                transform: translateX(0) translateY(0);
            }
        }

        .h-2 {
            height: 0.5rem;
        }

        .w-2 {
            width: 0.5rem;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .bg-blue-500 {
            background-color: #3b82f6;
        }

        .animation-delay-0 {
            animation-delay: 0s;
        }

        .animation-delay-1 {
            animation-delay: 0.2s;
        }

        .animation-delay-2 {
            animation-delay: 0.4s;
        }

        .animate-typing {
            animation: typing 1s ease-in-out infinite;
        }

        .animate-typing>* {
            animation-fill-mode: both;
        }

        .animate-typing>*:nth-child(1) {
            animation-delay: -0.2s;
        }

        .animate-typing>*:nth-child(2) {
            animation-delay: -0.1s;
        }

        .animate-typing>*:nth-child(3) {
            animation-delay: 0s;
        }
    </style>
</head>

<body class="h-screen">
    <!-- Navbar -->

    <nav class="bg-gray-300 py-3 px-6 h-0.5/6 flex justify-between items-center">
        <div class="flex items-center">
            <!-- Logo -->
            <a href="#" class="text-indigo-500 text-2xl font-bold">ORION</a>
            <!-- Search Bar -->
            <div class="mx-6 flex items-center">
                <input type="text"
                    class="bg-gray-900 text-white px-4 py-2 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-600"
                    placeholder="Search...">
                <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-full">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        <div class="flex items-center">
            <i class="fa-solid fa-house fa-2xl mr-10 hover:cursor-pointer" style="color: #005eff;"></i>
            <!-- Messages -->
            <a href="#" class="relative text-indigo-400 hover:text-white mr-6  ">
                <i class="fa-solid fa-2xl  hover:cursor-pointer fa-envelope" style="color: #005eff;"></i>
                <span
                    class="absolute top-0 right-0  px-2 py-1 translate-x-2/3 translate-y-1/2 bg-red-500 border border-white rounded-full text-xs text-white">12</span>
            </a>
            <!-- Notifications -->
            <a href="#" class="relative text-indigo-400 hover:text-white ">
                <i class=" fa-bell fa-solid fa-2xl  hover:cursor-pointer " style="color: #005eff;"></i>
                <span
                    class="absolute top-0 right-0  px-2 py-1 translate-x-2/3 translate-y-1/2 bg-red-500 border border-white rounded-full text-xs text-white">12</span>
            </a>
            <!-- Profile Image -->
            <div
                class="h-14 w-14 rounded-full ml-6 hover:cursor-pointer hover:shadow-lg shadow-cyan-500/50 overflow-hidden">
                <img src="https://picsum.photos/300/300" alt="Profile Image">
            </div>
        </div>


        </div>
    </nav>
    <div class="chat-container  h-5/6   mt-4  flex flex-row  gap-3">
        <div id="friendlist-section" class="overflow-auto justify-start basis-1/4 p-1 flex flex-col gap-3 shadow-md">








        </div>
        <div class="chat-message-section h-100 basis-1/2 gap-2 flex flex-col  ">
            <div class="flex flex-row justify-between basis-0.5/6">
                <div id="current-selected-friend"
                    class="friend-item flex hover:bg-gray-300 hover:cursor-pointer active:bg-violet-700 rounded-md flex-row">
                    <div class="user-photo-round-small relative w-8 h-8 mr-4">
                        <img class="rounded-full border border-gray-100 shadow-sm"
                            src="https://picsum.photos/300/300" />
                        <div
                            class="absolute top-0 right-0 h-3 w-3 my-1 border-2 border-white rounded-full bg-green-400 z-2">
                        </div>
                    </div>
                    <div class="user-name-last-message flex flex-col">
                        <p id="current-selected-friend-label" class="username font-bold text-lg">
                            orion electron
                        </p>
                        <p id="current-selected-friend-status" class="last-message text-gray-600 font-medium">
                            Active 5 hours ago
                        </p>
                    </div>
                </div>
                <div class="chat-icons w-30 ">
                    <i class="fa-solid fa-xl fa-phone mr-4 hover:cursor-pointer" onclick="start_audio_call()"
                        style="color: #095cec;"></i>
                    <i class="fa-solid fa-video fa-xl mr-4 hover:cursor-pointer" onclick="start_video_call()"
                        style="color: #095cec;"></i>
                    <i class="fa-solid fa-circle-exclamation fa-xl hover:cursor-pointer" onclick="open_chat_details()"
                        style="color: #025cf7;"></i>

                </div>

            </div>
            <div class="message-section flex flex-col basis-5/6">
                <div id="messages"
                    class=" overflow-y-auto h-500 flex flex-col gap-1 scroll-smooth rounded-md w-full basis-5/6 bg-gray-200 mb-4">




                </div>
                <div id="attachment-view"
                    class=" flex flex-row gap-2 mb-2 relative hidden basis-2/6 rounded-md overflow-y-scroll">
                    <div id="close_attachment_view" onclick="close_attachment_view()"
                        class="absolute top-0 right-0 h-6 w-6  border-2 border-white rounded-full bg-red-400 z-2">
                    </div>










                </div>
                <div class="message-input items-end pb-4 justify-end mb-4 w-full basis-1/6  gap-6 flex flex-row ">
                    <div class="attachment-area basis-1/6">
                        <input id="file-chooser" type="file" class="hidden"> </input>
                        <i class="fa-solid fa-xl pr-1 fa-paperclip  hover:cursor-pointer"
                            onclick="open_attachment_view()" style="color: #005eff;"></i>
                        <i class="fa-solid fa-xl pr-2 fa-image  hover:cursor-pointer" onclick="open_attachment_view()"
                            style="color: #005eff;"></i>
                        <i class="fa-solid fa-xl fa-face-smile  hover:cursor-pointer" onclick="open_attachment_view()"
                            style="color: #005eff;"></i>
                    </div>
                    <input type="hidden" name="user_id" id="user_id" , value="<%= user_id %>">
                    <input type="hidden" name="token" id="token" , value="<%= token %>">
                    <input id="user_message_input" oninput="inform_user_typing()"
                        class="p-2 basis-4/6 rounded-md border-indigo-500 border-2" placeholder="Enter Message " />
                    <button id="message_send_button" onclick="send_message()"
                        class="bg-indigo-500 p-2 rounded-lg text-white font-bold" id="send"> Send </button>



                </div>
            </div>
        </div>
        <div id="chat-details-section" class="hidden shadow-md items-center basis-1/4 flex gap-6 flex-col">
            <div class="details-profile-section flex flex-col items-center">
                <div>
                    <img class="rounded-full w-16 h-16" src="https://picsum.photos/200/200" />
                </div>

                <div>
                    <p id="chat-details-name" class=" font-bold"> Pawan Kandel </p>
                    <p> Active 4 h ago</p>
                </div>

            </div>
            <div class="profile-options flex w-full justify-between p-2 items-center space-x-4">
                <span class="text-gray-600 hover:cursor-pointer">
                    <i class="fas fa-user fa-solid fa-xl " style="color: #005eff;"></i>
                    <p class="text-gray-600">Profile</p>
                </span>

                <span class="text-gray-600 hover:cursor-pointer">
                    <i class="fas fa-volume-mute  fa-solid fa-xl " style="color: #005eff;"></i>
                    <p class="text-gray-600">Mute</p>
                </span>

                <span class="text-gray-600 hover:cursor-pointer">
                    <i class="fas fa-search  fa-solid fa-xl " style="color: #005eff;"></i>
                    <p class="text-gray-600">Search</p>
                </span>

            </div>

            <div class="relative inline-block text-left w-full">
                <div>
                    <button type="button"
                        class="inline-flex  w-full justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
                        id="menu-button" aria-expanded="true" aria-haspopup="true">
                        Customize Chat
                        <svg class="-mr-1 h-5 w-5 ml-auto text-gray-400" viewBox="0 0 20 20" fill="currentColor"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                                d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!--
                      Dropdown menu, show/hide based on menu state.
                  
                      Entering: "transition ease-out duration-100"
                        From: "transform opacity-0 scale-95"
                        To: "transform opacity-100 scale-100"
                      Leaving: "transition ease-in duration-75"
                        From: "transform opacity-100 scale-100"
                        To: "transform opacity-0 scale-95"
                    -->
                <div class="absolute w-full hidden z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                    role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                    <div class="py-1" role="none">
                        <!-- Active: "bg-gray-100 text-gray-900", Not Active: "text-gray-700" -->
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-0">Account settings</a>
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-1">Support</a>
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-2">License</a>
                        <form method="POST" action="#" role="none">
                            <button type="submit" class="text-gray-700 block w-full px-4 py-2 text-left text-sm"
                                role="menuitem" tabindex="-1" id="menu-item-3">Sign out</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="relative inline-block text-left w-full">
                <div>
                    <button type="button"
                        class="inline-flex w-full justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
                        id="menu-button" aria-expanded="true" aria-haspopup="true">
                        Media Options
                        <svg class="-mr-1 h-5 w-5 ml-auto text-gray-400" viewBox="0 0 20 20" fill="currentColor"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                                d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!--
                  Dropdown menu, show/hide based on menu state.
              
                  Entering: "transition ease-out duration-100"
                    From: "transform opacity-0 scale-95"
                    To: "transform opacity-100 scale-100"
                  Leaving: "transition ease-in duration-75"
                    From: "transform opacity-100 scale-100"
                    To: "transform opacity-0 scale-95"
                -->
                <div class="absolute hidden w-full z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                    role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                    <div class="py-1" role="none">
                        <!-- Active: "bg-gray-100 text-gray-900", Not Active: "text-gray-700" -->
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-0">Account settings</a>
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-1">Support</a>
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-2">License</a>
                        <form method="POST" action="#" role="none">
                            <button type="submit" class="text-gray-700 block w-full px-4 py-2 text-left text-sm"
                                role="menuitem" tabindex="-1" id="menu-item-3">Sign out</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="relative inline-block w-full text-left">
                <div>
                    <button type="button"
                        class="inline-flex w-full justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
                        id="menu-button" aria-expanded="true" aria-haspopup="true">
                        Privacy Options
                        <svg class="-mr-1 ml-auto h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                                d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!--
                  Dropdown menu, show/hide based on menu state.
              
                  Entering: "transition ease-out duration-100"
                    From: "transform opacity-0 scale-95"
                    To: "transform opacity-100 scale-100"
                  Leaving: "transition ease-in duration-75"
                    From: "transform opacity-100 scale-100"
                    To: "transform opacity-0 scale-95"
                -->
                <div class="absolute w-full hidden z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                    role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                    <div class="py-1" role="none">
                        <!-- Active: "bg-gray-100 text-gray-900", Not Active: "text-gray-700" -->
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-0">Account settings</a>
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-1">Support</a>
                        <a href="#" class="text-gray-700 block px-4 py-2 text-sm" role="menuitem" tabindex="-1"
                            id="menu-item-2">License</a>
                        <form method="POST" action="#" role="none">
                            <button type="submit" class="text-gray-700 block w-full px-4 py-2 text-left text-sm"
                                role="menuitem" tabindex="-1" id="menu-item-3">Sign out</button>
                        </form>
                    </div>
                </div>
            </div>







        </div>
    </div>
    <!-- incoming call modal -->
    <div id="incomingCallModal" class="fixed z-10 inset-0 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-6 rounded-lg shadow-xl">
                <h2 id="incoming_call_initiator" class="text-lg font-semibold mb-4">Incoming Call</h2>
                <p class="mb-4">Do you want to answer the call?</p>
                <div class="flex justify-end">
                    <button class="bg-red-500 text-white py-2 px-4 rounded-lg mr-4"
                        onclick="reject_video_call()">Reject</button>
                    <button class="bg-green-500 text-white py-2 px-4 rounded-lg" onclick="accept_video_call()">Answer</button>
                </div>
                <audio autoplay loop muted id="incomingCallSound" src="./assets/sound/incoming_call_sound.mp3">
                    <source src="./assets/sound/incoming_call_sound.mp3" type="audio/mp3">
                </audio>
            </div>

        </div>
    </div>

    <!-- video call modal -->
    <div id="videoChatModal" class="fixed z-10 inset-0 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-6 rounded-lg shadow-xl">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h2 class="text-lg font-semibold mb-4">Your Video</h2>
                        <video id="localVideo" autoplay playsinline muted="muted"></video>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold mb-4">Friend's Video</h2>
                        <video id="remoteVideo" autoplay playsinline></video>
                    </div>
                </div>
                <div class="flex justify-end mt-4">
                    <button class="bg-red-500 text-white py-2 px-4 rounded-lg" onclick="end_video_call()">End
                        Call</button>
                </div>
            </div>
        </div>
    </div>
    <div id="photo-message-modal" class=" fixed z-10 inset-0 overflow-y-auto hidden bg-gray-900">
        <div class="flex flex-col items-center justify-center min-h-screen">
            <div class=" bg-white p-6 rounded-lg shadow-xl">
                <img class="object-contain rounded-md h-full w-full" id="photo_message" src="" />

            </div>
            <div class="flex justify-end mt-4">
                <button class="bg-red-500 text-white py-2 px-4 rounded-lg"
                    onclick="close_photo_message_modal()">Close</button>
            </div>
        </div>
    </div>

    <script src="./assets/js/text_chat.js">

    </script>
    <script type="text/javascript" src="./assets/js/video_chat.js">

    </script>

</body>

</html>